<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <div th:replace="fragments/head :: head('Uniza Studio - Registrácia',false)"></div>
    <body class="bg-light">
        <div th:replace="fragments/header :: header"></div>
        <main>
          <section class="py-5 bg-light">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <div class="card shadow" style="max-width: 600px; margin: auto;">
                    <div class="card-header bg-dark text-white text-center py-3">
                      <h3 class="mb-0">Registrácia</h3>
                    </div>
                    <div class="card-body bg-white p-4">
                      <!-- Zmenený th:action na /public/register -->
                      <form method="POST" th:action="@{/public/register}" id="registrationForm">
                        <div class="row">
                          <!-- Prezývka -->
                          <div class="col-md-6 mb-2">
                            <label for="nickname" class="form-label">Prezývka</label>
                            <input type="text" minlength="4" maxlength="20" title="Prezývka musí mať od 4 do 20 znakov."
                                   class="form-control" id="nickname" name="nickname" value="JozkoMrkva" required>
                          </div>

                          <!-- UNIZA Email -->
                          <div class="col-md-6 mb-2">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   placeholder="example@stud.uniza.sk"
                                   pattern="^[a-zA-Z0-9._%+\-]+@(stud\.uniza\.sk|uniza\.sk)$"
                                   value="soltys10@stud.uniza.sk"
                                   title="Email musí končiť na @uniza.sk alebo na @stud.uniza.sk" required>
                          </div>

                          <!-- Heslo -->
                          <div class="col-md-6 mb-2">
                            <label for="password" class="form-label">Heslo</label>
                            <input type="password" class="form-control" id="password" name="password"
                                   pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9]).{8,}$"
                                   title="Heslo musí obsahovať min. 8 znakov vrátane aspoň 1 malého písmena, 1 veľkého písmena a 1 špeciálneho znaku."
                                   value="Uniza123."
                                   required>
                          </div>

                          <!-- Zopakovať heslo -->
                          <div class="col-md-6 mb-3">
                            <label for="passwordRepeat" class="form-label">Zopakovať heslo</label>
                            <input type="password" class="form-control" id="passwordRepeat" name="passwordRepeat"
                                   pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9]).{8,}$"
                                   title="Heslo musí obsahovať min. 8 znakov vrátane aspoň 1 malého písmena, 1 veľkého písmena a 1 špeciálneho znaku."
                                   value="Uniza123."
                                   required>
                          </div>
                        </div>
                        <!-- Odstránený onclick – formulár sa odošle prirodzene -->
                        <button type="submit" class="btn btn-uniza">Zaregistrovať</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </main>
        <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
        <script>
          function passwordsDoNotMatch(passwordInput, passwordRepeatInput) {
            if (passwordInput.value !== passwordRepeatInput.value) {
              passwordRepeatInput.setCustomValidity("Heslá sa nezhodujú!");
            } else {
              passwordRepeatInput.setCustomValidity("");
            }
          }

          function setUpPasswordsMatchValidation() {
            const passwordInput = document.getElementById('password');
            const passwordRepeatInput = document.getElementById('passwordRepeat');
            passwordInput.addEventListener('input', () => {
              passwordsDoNotMatch(passwordInput, passwordRepeatInput);
            });
            passwordRepeatInput.addEventListener('input', () => {
              passwordsDoNotMatch(passwordInput, passwordRepeatInput);
            });
          }

          // Zabezpečíme, aby sa formulár odoslal len ak je platný
          document.getElementById('registrationForm').addEventListener('submit', function(event) {
            if (!this.checkValidity()) {
              event.preventDefault();
              this.reportValidity();
            }
          });

          setUpPasswordsMatchValidation();
        </script>
    </body>
</html>
