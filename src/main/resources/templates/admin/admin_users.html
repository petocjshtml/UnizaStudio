<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{fragments/head :: head('Uniza Studio - Správa používateľov',true)}"></div>

<body class="bg-light">
<div th:replace="~{fragments/header :: header}"></div>

<main class="container my-4">
    <h2 class="mb-3">Správa používateľov</h2>

    <input type="text" id="userFilter" class="form-control my-3"
           placeholder="Filter používateľov..." onkeyup="filterUsers()">

    <table class="table table-bordered table-hover mt-4 text-center align-middle">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Profilovka</th>
            <th>Email</th>
            <th>Prezývka</th>
            <th>Práva</th>
            <th>Akcie</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user : ${users}">
            <td th:text="${user.id}">1</td>
            <td>
                <img th:src="${user.photo}" alt="foto" class="rounded-circle shadow-sm border"
                     style="height: 50px; width: 50px; object-fit: cover;">
            </td>
            <td th:text="${user.email}">email@example.com</td>
            <td th:text="${user.nickname}">nickname</td>
            <td>
                <span th:text="${user.isAdmin} ? 'Áno' : 'Nie'">Nie</span>
            </td>
            <td>
                <button class="btn btn-sm btn-warning open-edit-modal"
                        th:data-user-id="${user.id}"
                        th:data-email="${user.email}"
                        th:data-nickname="${user.nickname}"
                        th:data-photo="${user.photo}"
                        th:data-is-admin="${user.isAdmin}">
                    <i class="bi bi-pencil"></i>
                </button>

                <a th:href="@{'/admin/delete-user'(id=${user.id})}"
                   class="btn btn-sm btn-danger delete-user"
                   th:data-nickname="${user.nickname}">
                    <i class="bi bi-trash"></i>
                </a>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:replace="~{fragments/modal :: genericModal}"></div>
</main>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/logged_in.js}"></script>
<script th:src="@{/js/admin_users.js}" type="module"></script>

<script>
    function filterUsers() {
        let filter = document.getElementById("userFilter").value.toLowerCase();
        document.querySelectorAll("tbody tr").forEach(row => {
            let content = row.textContent.toLowerCase();
            row.style.display = content.includes(filter) ? "" : "none";
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.delete-user').forEach(btn => {
            btn.addEventListener('click', function (e) {
                if (!confirm(`Naozaj chcete vymazať používateľa "${this.dataset.nickname}"?`)) {
                    e.preventDefault();
                }
            });
        });
    });
</script>
</body>
</html>
